(this["webpackJsonpajugi-playlist-webapp"]=this["webpackJsonpajugi-playlist-webapp"]||[]).push([[0],{51:function(e,t,a){e.exports=a(65)},56:function(e,t,a){},63:function(e,t,a){},65:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),i=a(16),r=a.n(i),c=(a(56),a(12)),l=a(37),o=a(88),u=a(87),p=a(89),d=a(45),f=Object(d.a)({}),m=a(19),b=Object(m.b)({name:"spotifyClient",initialState:{apiToken:"",view:"playlists"},reducers:{setApiToken:function(e,t){e.apiToken=t.payload.apiToken},setView:function(e,t){e.view=t.payload.view}}}),y=function(){return k({apiToken:""})},v=b.actions,h=b.reducer,k=v.setApiToken,g=v.setView,w=h,j=a(18),O=a.n(j),E=a(22),I=a(35),T="https://api.spotify.com/v1/";function A(e){return S.apply(this,arguments)}function S(){return(S=Object(E.a)(O.a.mark((function e(t){var a,n,s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.spotifyAccessToken,n=t.url,e.next=3,fetch(n,{headers:{Authorization:"Bearer ".concat(a)}});case 3:if(!(s=e.sent).ok){e.next=6;break}return e.abrupt("return",s.json());case 6:return window.localStorage.setItem("apiToken",""),X.dispatch(y()),e.abrupt("return",[]);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){var t=e.playlistId,a=e.offset,n=void 0===a?0:a,s=e.limit,i=void 0===s?100:s,r=new URL("".concat(T,"playlists/").concat(t,"/tracks"));return r.searchParams.append("offset",n),r.searchParams.append("limit",i),r.href}var P=Object(m.b)({name:"playlists",initialState:{status:"idle",playlists:[],selectedPlaylistId:""},reducers:{setStatus:function(e,t){e.status=t.payload.status},playlistsReceived:function(e,t){var a;(a=e.playlists).push.apply(a,Object(I.a)(t.payload.items))},setSelectedPlaylistId:function(e,t){e.selectedPlaylistId=t.payload.selectedPlaylistId}}}),R=P.actions,_=P.reducer,C=R.setStatus,B=R.playlistsReceived,U=R.setSelectedPlaylistId,N=_,z=a(47),F=a(44),J=function(e){return e.albums.playlistId},L=function(e){return e.albums.status},V=function(e){return e.albums.pagination},W=function(e){return e.albums.albums},G=Object(m.b)({name:"albums",initialState:{playlistId:"",status:"idle",pagination:{offset:0,limit:100},albums:[]},reducers:{setPlaylistId:function(e,t){e.playlistId=t.payload.playlistId,e.pagination={offset:0,limit:100},e.songs=[]},setStatus:function(e,t){e.status=t.payload},songsReceived:function(e,t){var a;(a=e.songs).push.apply(a,Object(I.a)(t.payload.items));var n=t.payload,s=n.limit,i=n.offset;e.pagination={limit:s,offset:i}},showAlbums:function(e,t){e.albums=Object(F.groupBy)(e.songs,(function(e){var t,a;return null===e||void 0===e||null===(t=e.track)||void 0===t||null===(a=t.album)||void 0===a?void 0:a.id}))}}}),M=G.actions,$=G.reducer,q=M.setPlaylistId,D=M.setStatus,H=M.songsReceived,K=(M.showArtists,M.showAlbums),Q=$,X=Object(m.a)({reducer:{app:w,playlists:N,albums:Q}}),Y=function(e){return e.app.apiToken},Z=function(e){return e.app.view},ee={clientId:"6a53c434d5ce4fc2adb439113a5a7ec5",redirectUrl:"https://landscape.cartoonbeats.com/ajugi"};var te=function(){var e="https://accounts.spotify.com/authorize?response_type=token"+"&client_id=".concat(ee.clientId)+"&redirect_uri=".concat(ee.redirectUrl);return s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,"Click button to authorise with Spotify."),s.a.createElement("a",{href:e,rel:"noopener noreferrer"},"Authorise"))},ae=a(85),ne=a(86),se=a(90),ie=function(e){return e.playlists.playlists},re=function(e){return e.playlists.selectedPlaylistId};var ce=function(){var e=Object(c.b)(Y),t=Object(c.b)(ie),a=Object(c.b)(re);Object(n.useEffect)((function(){t.length>0||!e||X.dispatch(function(e){var t=e.spotifyAccessToken;return function(){var e=Object(E.a)(O.a.mark((function e(a,n){var s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a(C("loading")),e.prev=1,T+"me/playlists",e.next=5,A({spotifyAccessToken:t,url:"https://api.spotify.com/v1/me/playlists"});case 5:s=e.sent,a(B({items:s.items})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),console.log(e.t0);case 12:a(C("loaded"));case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,a){return e.apply(this,arguments)}}()}({spotifyAccessToken:e}))}),[e,t]);var i=a?s.a.createElement(ae.a,{variant:"contained",color:"primary",onClick:function(){X.dispatch(q({playlistId:a})),X.dispatch(g({view:"albums"}))}},"Show Albums"):null;return s.a.createElement(s.a.Fragment,null,s.a.createElement(ne.a,{className:"primary"},null===t||void 0===t?void 0:t.map((function(e){return s.a.createElement(se.a,{key:e.id,selected:a===e.id,onClick:function(){X.dispatch(U({selectedPlaylistId:e.id}))}},e.name)}))),i)},le=a(46);a(63);function oe(e){e.id;var t,a,n=null===(t=e.albumSongs[0])||void 0===t||null===(a=t.track)||void 0===a?void 0:a.album;if(!n)return null;var i=n.images[0].url,r=n.name,c="album";return n.total_tracks<7&&(c=n.total_tracks>3?"ep":"single"),s.a.createElement("img",{className:c,src:i,alt:r})}var ue=function(){var e=Object(c.b)(L),t=Object(c.b)(Y),a=Object(c.b)(W);if(Object(n.useEffect)((function(){X.dispatch(function(e){var t=e.spotifyAccessToken;return function(){var e=Object(E.a)(O.a.mark((function e(a,n){var s,i,r,c,l;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a(D("loading")),s=n(),i=J(s),r=V(s),e.prev=4,c=x(Object(z.a)({spotifyAccessToken:t,playlistId:i},r));case 6:return e.next=8,A({spotifyAccessToken:t,url:c});case 8:l=e.sent,a(H({items:l.items,offset:l.offset+l.limit,limit:l.limit})),c=l.next;case 11:if(c){e.next=6;break}case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),console.log(e.t0);case 17:a(D("loaded")),a(K());case 19:case"end":return e.stop()}}),e,null,[[4,14]])})));return function(t,a){return e.apply(this,arguments)}}()}({spotifyAccessToken:t}))}),[t]),"loading"===e)return"Loading songs\u2026";if(!a)return"Grouping albums\u2026";var i=Object.entries(a).map((function(e){var t=Object(le.a)(e,2),a=t[0],n=t[1];return s.a.createElement(oe,{key:a,id:a,albumSongs:n})}));return s.a.createElement("div",{className:"Albums-container"},i)},pe=a(3);var de=function(){for(var e={},t=/([^&;=]+)=?([^&;]*)/g,a=Object(pe.d)().hash.substring(1),n=t.exec(a);n;)e[n[1]]=decodeURIComponent(n[2]),n=t.exec(a);return e};function fe(){var e=de().access_token,t=Object(c.b)(Y),a=Object(c.b)(Z);return Object(n.useEffect)((function(){var t=window.localStorage.getItem("apiToken");e&&t!==e?(window.localStorage.setItem("apiToken",e),X.dispatch(k({apiToken:e}))):X.dispatch(k({apiToken:t}))}),[e]),t?"playlists"===a?s.a.createElement(ce,null):"albums"===a?s.a.createElement(ue,null):void 0:s.a.createElement(te,null)}var me=function(){return s.a.createElement(u.a,{theme:f},s.a.createElement(o.a,null),s.a.createElement(p.a,null,s.a.createElement(l.a,null,s.a.createElement(c.a,{store:X},s.a.createElement(fe,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(me,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[51,1,2]]]);
//# sourceMappingURL=main.23388b92.chunk.js.map