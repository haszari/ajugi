(this["webpackJsonpajugi-playlist-webapp"]=this["webpackJsonpajugi-playlist-webapp"]||[]).push([[0],{53:function(e,t,a){e.exports=a(67)},58:function(e,t,a){},65:function(e,t,a){},67:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),i=a(16),c=a.n(i),r=(a(58),a(10)),l=a(38),o=a(89),u=a(88),p=a(90),d=a(47),m=Object(d.a)({}),f=a(19),b=Object(f.b)({name:"spotifyClient",initialState:{apiToken:"",view:"playlists"},reducers:{setApiToken:function(e,t){e.apiToken=t.payload.apiToken},setView:function(e,t){e.view=t.payload.view}}}),v=function(){return k({apiToken:""})},y=b.actions,h=b.reducer,k=y.setApiToken,g=y.setView,w=h,j=a(18),E=a.n(j),O=a(22),I=a(36),A="https://api.spotify.com/v1/";function S(e){return T.apply(this,arguments)}function T(){return(T=Object(O.a)(E.a.mark((function e(t){var a,n,s;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.spotifyAccessToken,n=t.url,e.next=3,fetch(n,{headers:{Authorization:"Bearer ".concat(a)}});case 3:if(!(s=e.sent).ok){e.next=6;break}return e.abrupt("return",s.json());case 6:return window.localStorage.setItem("apiToken",""),Z.dispatch(v()),e.abrupt("return",[]);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){var t=e.playlistId,a=e.offset,n=void 0===a?0:a,s=e.limit,i=void 0===s?100:s,c=new URL("".concat(A,"playlists/").concat(t,"/tracks"));return c.searchParams.append("offset",n),c.searchParams.append("limit",i),c.href}var P=Object(f.b)({name:"playlists",initialState:{status:"idle",playlists:[],selectedPlaylistId:""},reducers:{setStatus:function(e,t){e.status=t.payload.status},playlistsReceived:function(e,t){var a;(a=e.playlists).push.apply(a,Object(I.a)(t.payload.items))},setSelectedPlaylistId:function(e,t){e.selectedPlaylistId=t.payload.selectedPlaylistId}}}),C=P.actions,N=P.reducer,R=C.setStatus,_=C.playlistsReceived,U=C.setSelectedPlaylistId,B=N,z=a(30),J=a(45),L=function(e){return e.albums.playlistId},F=function(e){return e.albums.status},V=function(e){return e.albums.pagination},W=function(e){return e.albums.albums},D=function(e){return e.albums.selectedAlbumId},G=Object(f.b)({name:"albums",initialState:{playlistId:"",status:"idle",pagination:{offset:0,limit:100},albums:{},selectedAlbumId:""},reducers:{setPlaylistId:function(e,t){e.playlistId=t.payload.playlistId,e.pagination={offset:0,limit:100},e.songs=[]},setStatus:function(e,t){e.status=t.payload},songsReceived:function(e,t){var a;(a=e.songs).push.apply(a,Object(I.a)(t.payload.items));var n=t.payload,s=n.limit,i=n.offset;e.pagination={limit:s,offset:i}},showAlbums:function(e,t){e.albums=Object(J.groupBy)(e.songs,(function(e){var t,a;return null===e||void 0===e||null===(t=e.track)||void 0===t||null===(a=t.album)||void 0===a?void 0:a.id}))},setSelectedAlbumId:function(e,t){e.selectedAlbumId=t.payload}}}),M=G.actions,$=G.reducer,q=M.setPlaylistId,H=M.setStatus,K=M.setSelectedAlbumId,Q=M.songsReceived,X=(M.showArtists,M.showAlbums),Y=$,Z=Object(f.a)({reducer:{app:w,playlists:B,albums:Y}}),ee=function(e){return e.app.apiToken},te=function(e){return e.app.view},ae={clientId:"6a53c434d5ce4fc2adb439113a5a7ec5",redirectUrl:"https://landscape.cartoonbeats.com/ajugi"},ne=Object(z.a)(Object(z.a)({},ae),{},{scopes:"user-read-private user-read-email streaming app-remote-control user-modify-playback-state"});var se=function(){var e="https://accounts.spotify.com/authorize?response_type=token"+"&client_id=".concat(ne.clientId)+"&redirect_uri=".concat(ne.redirectUrl)+"&scope=".concat(encodeURIComponent(ne.scopes));return s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,"Click button to authorise with Spotify."),s.a.createElement("a",{href:e,rel:"noopener noreferrer"},"Authorise"))},ie=a(86),ce=a(87),re=a(91),le=function(e){return e.playlists.playlists},oe=function(e){return e.playlists.selectedPlaylistId};var ue=function(){var e=Object(r.b)(ee),t=Object(r.b)(le),a=Object(r.b)(oe);Object(n.useEffect)((function(){t.length>0||!e||Z.dispatch(function(e){var t=e.spotifyAccessToken;return function(){var e=Object(O.a)(E.a.mark((function e(a,n){var s;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a(R("loading")),e.prev=1,A+"me/playlists",e.next=5,S({spotifyAccessToken:t,url:"https://api.spotify.com/v1/me/playlists"});case 5:s=e.sent,a(_({items:s.items})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),console.log(e.t0);case 12:a(R("loaded"));case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,a){return e.apply(this,arguments)}}()}({spotifyAccessToken:e}))}),[e,t]);var i=a?s.a.createElement(ie.a,{variant:"contained",color:"primary",onClick:function(){Z.dispatch(q({playlistId:a})),Z.dispatch(g({view:"albums"}))}},"Show Albums"):null;return s.a.createElement(s.a.Fragment,null,s.a.createElement(ce.a,{className:"primary"},null===t||void 0===t?void 0:t.map((function(e){return s.a.createElement(re.a,{key:e.id,selected:a===e.id,onClick:function(){Z.dispatch(U({selectedPlaylistId:e.id}))}},e.name)}))),i)},pe=a(48),de=a(46),me=a.n(de);a(65);function fe(e){var t,a,n,i,c=e.id,l=e.albumSongs,o=e.isSelected,u=Object(r.b)(ee),p=null===(t=l[0])||void 0===t||null===(a=t.track)||void 0===a?void 0:a.album;if(!p)return null;var d=null===(n=p.artists[0])||void 0===n?void 0:n.name,m=p.name,f=p.release_date,b=null===(i=p.images[0])||void 0===i?void 0:i.url,v=p.uri,y="album";p.total_tracks<7&&(y=p.total_tracks>3?"ep":"single");var h=o?s.a.createElement("div",{className:"info"},s.a.createElement("div",{className:"artist"},d),s.a.createElement("div",{className:"title"},m),s.a.createElement("div",{className:"releaseDate"},f),s.a.createElement(ie.a,{variant:"contained",color:"primary",onClick:function(){!function(e){var t=e.spotifyAccessToken,a=e.uri,n=new URL("".concat(A,"me/player/play"));fetch(n,{method:"PUT",headers:{Authorization:"Bearer ".concat(t)},body:JSON.stringify({context_uri:a})})}({spotifyAccessToken:u,uri:v})}},"Play")):null;return s.a.createElement("div",{className:me()("release",y,{isSelected:o})},s.a.createElement("img",{onClick:function(){o?Z.dispatch(K("")):Z.dispatch(K(c))},src:b,alt:m}),h)}var be=function(){var e=Object(r.b)(F),t=Object(r.b)(ee),a=Object(r.b)(D),i=Object(r.b)(W);if(Object(n.useEffect)((function(){Z.dispatch(function(e){var t=e.spotifyAccessToken;return function(){var e=Object(O.a)(E.a.mark((function e(a,n){var s,i,c,r,l;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a(H("loading")),s=n(),i=L(s),c=V(s),e.prev=4,r=x(Object(z.a)({spotifyAccessToken:t,playlistId:i},c));case 6:return e.next=8,S({spotifyAccessToken:t,url:r});case 8:l=e.sent,a(Q({items:l.items,offset:l.offset+l.limit,limit:l.limit})),r=l.next;case 11:if(r){e.next=6;break}case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),console.log(e.t0);case 17:a(H("loaded")),a(X());case 19:case"end":return e.stop()}}),e,null,[[4,14]])})));return function(t,a){return e.apply(this,arguments)}}()}({spotifyAccessToken:t}))}),[t]),"loading"===e)return"Loading songs\u2026";if(!i)return"Grouping albums\u2026";var c=Object.entries(i).map((function(e){var t=Object(pe.a)(e,2),n=t[0],i=t[1];return s.a.createElement(fe,{key:n,id:n,albumSongs:i,isSelected:n===a})}));return s.a.createElement("div",{className:"Albums-container"},c)},ve=a(3);var ye=function(){for(var e={},t=/([^&;=]+)=?([^&;]*)/g,a=Object(ve.d)().hash.substring(1),n=t.exec(a);n;)e[n[1]]=decodeURIComponent(n[2]),n=t.exec(a);return e};function he(){var e=ye().access_token,t=Object(r.b)(ee),a=Object(r.b)(te);return Object(n.useEffect)((function(){var t=window.localStorage.getItem("apiToken");e&&t!==e?(window.localStorage.setItem("apiToken",e),Z.dispatch(k({apiToken:e}))):Z.dispatch(k({apiToken:t}))}),[e]),t?"playlists"===a?s.a.createElement(ue,null):"albums"===a?s.a.createElement(be,null):void 0:s.a.createElement(se,null)}var ke=function(){return s.a.createElement(u.a,{theme:m},s.a.createElement(o.a,null),s.a.createElement(p.a,null,s.a.createElement(l.a,null,s.a.createElement(r.a,{store:Z},s.a.createElement(he,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(ke,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[53,1,2]]]);
//# sourceMappingURL=main.1d0d7242.chunk.js.map